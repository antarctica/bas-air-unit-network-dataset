---

include:
  - template: 'Workflows/MergeRequest-Pipelines.gitlab-ci.yml'

variables:
  # CI config
  PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"

cache:
  paths:
    - .cache/pip  # for pipx/pip
    - .venv/   # for project dependencies

image:
  name: python:3.8-slim

stages:
  - ðŸ§ª test
  - ðŸ“‹ lint

before_script:
    - python --version
    - python -m pip install --upgrade pip
    - python -m pip install pipx
    - python -m pipx install poetry==1.4.2
    - python -m pipx ensurepath
    - export PATH=$PATH:/root/.local/bin
    - poetry --version
    - poetry check
    - poetry config virtualenvs.in-project true
    - poetry install --no-interaction --no-ansi

test:
  stage: ðŸ§ª test
  needs: []
  script:
    - poetry run airnet --help
  rules:
    - changes:
        - '**/*.py'

lint:
  stage: ðŸ“‹ lint
  needs: []
  script:
    - poetry run flake8 src/
    - poetry run safety check --full-report
  rules:
    - changes:
        - '**/*.py'
